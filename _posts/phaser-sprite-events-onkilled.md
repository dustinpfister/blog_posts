---
title: The Sprite onKilled event in phaser
date: 2018-09-13 20:54:00
tags: [js,phaser]
layout: post
categories: phaser
id: 278
updated: 2018-09-14 13:06:03
version: 1.2
---

When making a [Phaser ce](https://photonstorm.github.io/phaser-ce/) powered javaScript game project there are of course sprites, and when working with sprites there are useful events. In this post the focus will be on the onKilled event in phaser ce. This is a signal that will fire when the sprite.kill method is called, which is very different from sprite.destroy. The kill method is what I would call if I want to set certain values to what would be appropriate if the sprite has been killed, but I do not want to actually destroy the sprite completely. So in this post I will be coving some use case examples for this method.

<!-- more -->

## 1 - Start here

In this post I am writing about the onKilled event that is fired when a sprite is killed with the sprite.killed method in phaser ce. There is also the onDestroy event that is fired when a sprite is completely removed from the game world, and cache completely. In most projects I like to have a pool of sprite objects that I reuse, rather than the alternative which would be a mechanic where there is no set maximum of enemies that can be in the world. In any case it is good to be ware of both of these events, as well as the many other events that are fired by game objects in phaser ce.

### 1.1 - This is a phaser ce 2.x post

In this post I am using phaser ce 2.11.0, not the newer phaser 3.x major release.

## 2 - A full example using sprite.events.onKilled

### 2.1 - My enemies.js file

#### 2.1.1 - Staring off the file, and Enemy.setup

```js
var Enemy = {};
 
// setup a game.data object
Enemy.setup = function () {
 
    this.game.data = {
 
        maxEnemies: 5,
        enemies: null,
        score: 0
 
    };
 
};
```

#### 2.1.2 - The Enemy.onKill handler

```js
// The onKill method that will be called each time an enemy is killed
Enemy.onKill = function (sprite) {
 
    var game = this.game,
    spriteSpeed = (sprite.data.dx + sprite.data.dy) / 8,
    speedBonus = 175, // points bonus for speed.
    perKill = 25; // points per kill
 
    // score formula
    game.data.score += perKill + Math.floor(spriteSpeed * speedBonus);
 
};
```

#### 2.1.3 - The Enemy.onInputDown handler

```js
// What happens when the player clicks an enemy
Enemy.onInputDown = function (enemy) {
 
    enemy.data.hp -= 1;
 
    if (enemy.data.hp === 1) {
        enemy.frame = 1;
    }
 
    if (enemy.data.hp <= 0) {
        enemy.kill();
    }
 
};
```

#### 2.1.4 - Generate Sprite Data objects

```js
// generate a data object for a sprite
Enemy.genSpriteData = function () {
 
    return {
        dx: Math.random() * 3.5 + 0.5,
        dy: Math.random() * 3.5 + 0.5,
        hp: 2
    };
 
};
```

#### 2.1.5 - Make a sprite sheet with canvas

```js
// make a sprite sheet
Enemy.mkSheet = function (game) {
 
    // sprite sheet generated by canvas
    var canvas = document.createElement('canvas'),
    ctx = canvas.getContext('2d');
    canvas.width = 64;
    canvas.height = 32;
 
    // blue frame
    ctx.fillStyle = '#0000ff';
    ctx.fillRect(0, 0, 32, 32);
 
    // red frame
    ctx.fillStyle = '#ff0000';
    ctx.fillRect(32, 0, 32, 32);
 
    game.cache.addSpriteSheet('sheet-block', null, canvas, 32, 32, 2, 0, 0);
 
};
```

#### 2.1.6 - Create a pool of enemies

```js
// create a group of enemies
Enemy.createEnemyPool = function () {
 
    var i = 0,
    data = this.game.data;
 
    // make data.enemies a new group
    data.enemies = game.add.group();
 
    // make a pool of enemies in the group
    while (i < data.maxEnemies) {
 
        var enemy = data.enemies.create(0, 0, 'sheet-block');
 
        // enemy starts out killed
        enemy.kill();
 
        // attach onKilled event
        enemy.events.onKilled.add(Enemy.onKill, this);
 
        // attach on input down event
        enemy.inputEnabled = true;
        enemy.events.onInputDown.add(Enemy.onInputDown, this);
 
        i += 1;
 
    }
 
};
```

#### 2.1.7 - The spawn method

```js
// re-spawn a dead enemy
Enemy.spawn = function (a) {
 
    var enemies = this.game.data.enemies;
 
    var dead = enemies.getFirstDead(false, 0, 0, 'sheet-block', 0);
 
    // if there is
    if (dead) {
 
        dead.data = Enemy.genSpriteData();
 
    }
 
};
```

#### 2.1.8 - An update method for the enemies

```js
// What needs to happen for each frame tick
Enemy.update = function () {
 
    var data = this.game.data,
    game = this.game;
 
    // loop all enemies
    data.enemies.forEach(function (enemy) {
 
        // step position based on current deltas
        enemy.x = Phaser.Math.wrap(enemy.x += enemy.data.dx, -32, game.world.width + 32);
        enemy.y = Phaser.Math.wrap(enemy.y += enemy.data.dy, -32, game.world.height + 32);
 
    });
 
};
```